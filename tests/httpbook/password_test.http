# HTTP Book - Authentication & Password Scenarios
# @name auth_password_tests
# Update `baseUrl`, credentials, and tokens as needed before executing the requests.

@baseUrl = http://localhost:3000
@clientId = development-client-id
@secretKey = development-secret-key
@twoFactorCode = 719807
@userId = 01K9ABA6MQ9K64MY7M4AEBCAP2
@userEmail = abidi.mahyar@gmail.com
###
# Use valid credentials to authenticate and capture the returned access token.
POST {{baseUrl}}/api/auth/login
content-type: application/json

{
  "email": "abidi.mahyar@gmail.com",
  "password": "NewPassword!123"
}

HTTP/1.1 200  - OK
vary: rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch
content-type: application/json
# SECURITY: Example tokens redacted - these are test responses only
# In production, never commit real JWT tokens to version control
# nosemgrep: generic.secrets.security.detected-jwt-token
# Rationale: JWT tokens are redacted in test file - <REDACTED_JWT_TOKEN> is not a real token
set-cookie: access_token=<REDACTED_JWT_TOKEN>; Path=/; Expires=Mon, 10 Nov 2025 11:08:27 GMT; Max-Age=3600; HttpOnly; SameSite=lax, refresh_token=<REDACTED_JWT_TOKEN>; Path=/; Expires=Mon, 17 Nov 2025 10:08:27 GMT; Max-Age=604800; HttpOnly; SameSite=lax
date: Mon, 10 Nov 2025 10:08:27 GMT
connection: close
transfer-encoding: chunked
###
POST {{baseUrl}}/api/auth/login
content-type: application/json

{
  "email": "",
  "password": ""
}

HTTP/1.1 400  - Bad Request
vary: rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch
content-type: application/json
date: Mon, 10 Nov 2025 08:56:39 GMT
connection: close
transfer-encoding: chunked
###
POST {{baseUrl}}/api/auth/login
content-type: application/json

{
  "email": "abidi.mahyar@gmail.com",
  "password": "WrongPassword123"
}

HTTP/1.1 401  - Unauthorized
vary: rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch
content-type: application/json
date: Mon, 10 Nov 2025 08:56:42 GMT
connection: close
transfer-encoding: chunked
###
POST {{baseUrl}}/api/auth/password/change
content-type: application/json

{
  "clientId": "{{clientId}}",
  "secretKey": "{{secretKey}}",
  "username": "{{userEmail}}",
  "currentPassword": "Mm123456",
  "newPassword": "NewPassword!123"
}

HTTP/1.1 400  - Bad Request
vary: rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch
content-type: application/json
date: Mon, 10 Nov 2025 08:56:56 GMT
connection: close
transfer-encoding: chunked
###
POST {{baseUrl}}/api/auth/password/change
content-type: application/json

{
  "clientId": "{{clientId}}",
  "secretKey": "{{secretKey}}",
  "username": "{{userEmail}}",
  "currentPassword": "",
  "newPassword": ""
}

HTTP/1.1 400  - Bad Request
vary: rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch
content-type: application/json
date: Mon, 10 Nov 2025 10:07:19 GMT
connection: close
transfer-encoding: chunked
###
POST {{baseUrl}}/api/auth/2fa/generate
content-type: application/json

{
  "userId": "{{userId}}",
  "clientId": "{{clientId}}",
  "secretKey": "{{secretKey}}",
  "ttlSeconds": 300
}

HTTP/1.1 200  - OK
vary: rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch
content-type: application/json
date: Mon, 10 Nov 2025 10:08:02 GMT
connection: close
transfer-encoding: chunked
###
POST {{baseUrl}}/api/auth/2fa/validate
content-type: application/json

{
  "userId": "{{userId}}",
  "code": "182918",
  "clientId": "{{clientId}}",
  "secretKey": "{{secretKey}}"
}

HTTP/1.1 410  - Gone
vary: rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch
content-type: application/json
date: Mon, 10 Nov 2025 10:07:58 GMT
connection: close
transfer-encoding: chunked
###
POST {{baseUrl}}/api/auth/password/reset
content-type: application/json

{
  "username": "{{userEmail}}",
  "code": "835321",
  "password": "NewPassword!123",
  "confirmPassword": "NewPassword!123"
}

HTTP/1.1 200  - OK
vary: rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch
content-type: application/json
date: Mon, 10 Nov 2025 10:08:16 GMT
connection: close
transfer-encoding: chunked